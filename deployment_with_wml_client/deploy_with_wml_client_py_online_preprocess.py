# for those using older ibm_watson_machine_learning version, please update use below code
import subprocess
# output = subprocess.run(["pip3", "install", "ibm-watson-machine-learning", "--upgrade"], capture_output=True, text=True).stdout
# print(output)

import argparse
import yaml
import ast
import os

# preprocess_assets = {}
# output_json_str = ""
# output_json = {}

if __name__ == '__main__':
    parser = argparse.ArgumentParser(description='Deploy Code Packages')

    parser.add_argument('--yaml_file', '-y', type=str,
                        default='cpd471_prod_online_mnist_preprocess.yaml')

    parser.add_argument(
        '--test_run', '-t',
        default = 'True',
        help='True or False flag, input should be either "True" or "False".',
        type=ast.literal_eval,
        dest='test_run'
    )
    args = parser.parse_args()

    yaml_file = args.yaml_file
    test_run = args.test_run

    # Read YAML file
    print('\n-- Loading configuration yaml file:',yaml_file)
    with open(yaml_file, 'r') as stream:
        configuration = yaml.safe_load(stream)

    # print(configuration)

    wml_credentials = configuration['wml_credentials']
    deployment_info = configuration['deployment_info']
    prj_info = configuration['prj_info']
    if "email_setting" in configuration:
        email_setting = configuration['email_setting']
        #print('\n\rsend_email_when_fail: ',email_setting['send_email_when_fail'])
        #print('send_email_when_successful: ', email_setting['send_email_when_successful'])
    else:
        email_setting = []
        #print('\n\rEmail not enabled')


    print('\n\rCode Package to be deployed:')
    print(prj_info,'\n\r')

    # step 1: login to wml
    from wml_client_api import wml_login
    wml_client = wml_login(wml_credentials)

    space_id = deployment_info['space_id']
    wml_client.set.default_space(space_id)
    print("\n\rSet space id successfully:", space_id)

    # From cpd 4.x, deployment function can get the token inside. Hence we don't need password as parameters anymore.
    if "version" in wml_credentials:
        version = wml_credentials['version']
        if version[0]>'3':
            # remove credentials to avoid disclosure of the password.
            if "password" in wml_credentials:
                del wml_credentials['password']

    # This is a generator code needed by CP4D to run your code. In most cases, you don't have to modify it.
    def my_deployable_function(wml_credentials=wml_credentials, deployment_info=deployment_info, prj_info=prj_info,
                               email_setting=email_setting):

        import os
        import subprocess

        # get USER_ACCESS_TOKEN directly without leaking token, username and password in the deployment function
        if "version" in wml_credentials:
            version = wml_credentials['version']
            if version[0] > '3':
                user_token = os.environ["USER_ACCESS_TOKEN"]
                wml_credentials['token'] = user_token

        if email_setting:
            send_email_when_successful = email_setting['send_email_when_successful']
            send_email_when_fail = email_setting['send_email_when_fail']
            sender = email_setting['sender']
            receivers = email_setting['receivers']
            smtp_server = email_setting['smtp_server']
        else:
            send_email_when_successful = False
            send_email_when_fail = False

        from ibm_watson_machine_learning import APIClient
        wml_client = APIClient(wml_credentials)

        space_id = deployment_info['space_id']
        wml_client.set.default_space(space_id)

        def get_assets_dict():
            assets_dict = {x["metadata"]["name"]: x["metadata"]["asset_id"] for x in
                           wml_client.data_assets.get_details()["resources"]}
            return assets_dict

        import smtplib
        def send_email(smtp_server, sender, receivers, message):
            try:
                smtpObj = smtplib.SMTP(smtp_server)
                smtpObj.sendmail(sender, receivers, message)
                print("Notification Email Sent Successfully")
            # except SMTPException:
            except:
                print("Error: unable to send email")

        def get_date_str():
            from datetime import datetime
            date_str = datetime.now().strftime("%Y-%m-%d")
            return date_str

        date_str = get_date_str()

        assets_dict = get_assets_dict()

        # prj_info = params["prj_info"]
        code_pkg_name = deployment_info['code_pkg_name']
        tar_file_name = code_pkg_name + ".tar.gz"
        wml_client.data_assets.download(assets_dict[tar_file_name], tar_file_name)
        # for f in params["required_files"]: wml_client.data_assets.download(assets_dict[f], f)

        subprocess.run(["tar", "xzf", tar_file_name])

        # The reason we need pre-processing is to save time for the online API.
        # Otherwise, lots of time will be spent on some repetitive tasks, eg loading large ML models

        # Please ignore below error "main_online" because once code package is extracted, it will run
        from main_online import preprocess
        preprocess_assets = preprocess()
        print(preprocess_assets)

        import traceback
        import json

        def score(payload):

            try:
                # Please ignore below error "main_online" because once code package is extracted, it will run
                from main_online import main_process
                output_json_str = main_process(payload,preprocess_assets)

                try:
                    #output_json = ast.literal_eval(output_json_str)
                    output_json = json.loads(output_json_str)
                except Exception as e:
                    output_json = {"info": ["JSON String not found on output: ", output_json_str]}

            except Exception as e:
                print(e)
                print(traceback.format_exc())
                output_json = {"stderr": str(traceback.format_exc())}

            deploy_mode = deployment_info['deploy_mode']
            if deploy_mode == 'online':
                pred_json = {"predictions": [output_json]}
                return pred_json  # work
            else:
                # somehow batchmode will never finish with above formart, but below works
                return {"predictions": [{"values": [output_json]}]}

        return score

    # step 2: upload_code_2_deployment_space
    from wml_client_api import upload_code_2_deployment_space
    code_pkg_name = deployment_info['code_pkg_name']
    upload_code_2_deployment_space(wml_client, prj_info, code_pkg_name)

    # # optional step 2a: test deployment function locally
    # payload = {"input_data": [{"fields": ["image"], "values": [[[[-0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, 0.6449587345123291, 1.930510401725769, 1.5995763540267944, 1.4977505207061768, 0.33948105573654175, 0.034003473818302155, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, 2.4014549255371094, 2.808758497238159, 2.808758497238159, 2.808758497238159, 2.808758497238159, 2.643291473388672, 2.095977306365967, 2.095977306365967, 2.095977306365967, 2.095977306365967, 2.095977306365967, 2.095977306365967, 2.095977306365967, 2.095977306365967, 1.7395868301391602, 0.23765520751476288, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, 0.4285787343978882, 1.0268056392669678, 0.4922199249267578, 1.0268056392669678, 1.6504892110824585, 2.4650962352752686, 2.808758497238159, 2.4396398067474365, 2.808758497238159, 2.808758497238159, 2.808758497238159, 2.757845640182495, 2.4905526638031006, 2.808758497238159, 2.808758497238159, 1.3577399253845215, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.20783297717571259, 0.41585052013397217, -0.2460176944732666, 0.4285787343978882, 0.4285787343978882, 0.4285787343978882, 0.32675284147262573, -0.15692004561424255, 2.5796501636505127, 2.808758497238159, 0.9249798059463501, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, 0.6322304606437683, 2.796030282974243, 2.235987901687622, -0.19510474801063538, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.14419181644916534, 2.5414655208587646, 2.821486711502075, 0.6322304606437683, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, 1.2177293300628662, 2.808758497238159, 2.605106830596924, 0.13582934439182281, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, 0.32675284147262573, 2.7451171875, 2.808758497238159, 0.36493754386901855, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, 1.2686423063278198, 2.808758497238159, 1.955966830253601, -0.36057180166244507, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.30965885519981384, 2.185075044631958, 2.732388973236084, 0.31402459740638733, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, 1.179544448852539, 2.808758497238159, 1.8923256397247314, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, 0.5304046273231506, 2.770573854446411, 2.630563259124756, 0.3012963533401489, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.18237650394439697, 2.3887267112731934, 2.808758497238159, 1.688673973083496, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.3860282599925995, 2.159618616104126, 2.808758497238159, 2.3632702827453613, 0.021275240927934647, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, 0.05945993959903717, 2.808758497238159, 2.808758497238159, 0.5558610558509827, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.029637714847922325, 2.4269113540649414, 2.808758497238159, 1.0395338535308838, -0.4114847183227539, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, 1.2686423063278198, 2.808758497238159, 2.808758497238159, 0.23765520751476288, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, 0.35220929980278015, 2.656019687652588, 2.808758497238159, 2.808758497238159, 0.23765520751476288, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, 1.1159032583236694, 2.808758497238159, 2.808758497238159, 2.3632702827453613, 0.08491640537977219, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, 1.1159032583236694, 2.808758497238159, 2.21053147315979, -0.19510474801063538, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923, -0.4242129623889923]]]]}]}
    # function_result = my_deployable_function(wml_credentials, deployment_info, prj_info, email_setting)(payload)
    # print('function_result=\n',function_result)

    # step 3: deploy
    from wml_client_api import deploy
    function_deployment_id = deploy(wml_client, my_deployable_function, deployment_info)


    # to do --- clean
    # remove tar file

    # step 4: run the job
    if test_run:
        deploy_mode = deployment_info['deploy_mode']
        # payload = {
        #     "input_data": [
        #         {
        #             "fields": [],
        #             "values": [1]  # 1 is a dummy input that needed
        #         }
        #     ]
        # }
        payload = {"input_data": [{"fields": ["image"], "values": [[[[-0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      0.6449587345123291, 1.930510401725769,
                                                                      1.5995763540267944, 1.4977505207061768,
                                                                      0.33948105573654175, 0.034003473818302155,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      2.4014549255371094, 2.808758497238159,
                                                                      2.808758497238159, 2.808758497238159,
                                                                      2.808758497238159, 2.643291473388672,
                                                                      2.095977306365967, 2.095977306365967,
                                                                      2.095977306365967, 2.095977306365967,
                                                                      2.095977306365967, 2.095977306365967,
                                                                      2.095977306365967, 2.095977306365967,
                                                                      1.7395868301391602, 0.23765520751476288,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      0.4285787343978882, 1.0268056392669678,
                                                                      0.4922199249267578, 1.0268056392669678,
                                                                      1.6504892110824585, 2.4650962352752686,
                                                                      2.808758497238159, 2.4396398067474365,
                                                                      2.808758497238159, 2.808758497238159,
                                                                      2.808758497238159, 2.757845640182495,
                                                                      2.4905526638031006, 2.808758497238159,
                                                                      2.808758497238159, 1.3577399253845215,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.20783297717571259,
                                                                      0.41585052013397217, -0.2460176944732666,
                                                                      0.4285787343978882, 0.4285787343978882,
                                                                      0.4285787343978882, 0.32675284147262573,
                                                                      -0.15692004561424255, 2.5796501636505127,
                                                                      2.808758497238159, 0.9249798059463501,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      0.6322304606437683, 2.796030282974243,
                                                                      2.235987901687622, -0.19510474801063538,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.14419181644916534,
                                                                      2.5414655208587646, 2.821486711502075,
                                                                      0.6322304606437683, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, 1.2177293300628662,
                                                                      2.808758497238159, 2.605106830596924,
                                                                      0.13582934439182281, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      0.32675284147262573, 2.7451171875,
                                                                      2.808758497238159, 0.36493754386901855,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      1.2686423063278198, 2.808758497238159,
                                                                      1.955966830253601, -0.36057180166244507,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.30965885519981384,
                                                                      2.185075044631958, 2.732388973236084,
                                                                      0.31402459740638733, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, 1.179544448852539,
                                                                      2.808758497238159, 1.8923256397247314,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      0.5304046273231506, 2.770573854446411,
                                                                      2.630563259124756, 0.3012963533401489,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.18237650394439697,
                                                                      2.3887267112731934, 2.808758497238159,
                                                                      1.688673973083496, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.3860282599925995, 2.159618616104126,
                                                                      2.808758497238159, 2.3632702827453613,
                                                                      0.021275240927934647, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      0.05945993959903717, 2.808758497238159,
                                                                      2.808758497238159, 0.5558610558509827,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.029637714847922325,
                                                                      2.4269113540649414, 2.808758497238159,
                                                                      1.0395338535308838, -0.4114847183227539,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, 1.2686423063278198,
                                                                      2.808758497238159, 2.808758497238159,
                                                                      0.23765520751476288, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      0.35220929980278015, 2.656019687652588,
                                                                      2.808758497238159, 2.808758497238159,
                                                                      0.23765520751476288, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      1.1159032583236694, 2.808758497238159,
                                                                      2.808758497238159, 2.3632702827453613,
                                                                      0.08491640537977219, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      1.1159032583236694, 2.808758497238159,
                                                                      2.21053147315979, -0.19510474801063538,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923,
                                                                      -0.4242129623889923, -0.4242129623889923]]]]}]}

        # run online application
        if deploy_mode == 'online':
            result = wml_client.deployments.score(function_deployment_id, payload)
            print('result=\n', result)

        # for batch job
        # below code is a reference if you want to schedule job externally using 3rd tool, eg Control M
        else:
            job = wml_client.deployments.create_job(function_deployment_id, meta_props=payload)
            job_id = wml_client.deployments.get_job_uid(job)
            print('\n\rjob_id: "%s" successfully submitted' % job_id)
            wml_client.deployments.get_job_details(job_id)

